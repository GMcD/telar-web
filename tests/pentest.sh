#!/bin/bash

AUTH=https://auth.prod.monitalks.io
API=https://int-api.prod.monitalks.io/function
FAAS=https://openfaas.prod.monitalks.io/function

COGNITO_URL=${AUTH}/cognito

API_PROFILE_URL=${API}/profile/my
FAAS_PROFILE_URL=${FAAS}/profile/my

ACCESS=$(curl -s -X POST --data $CREDENTIALS $COGNITO_URL | jq -r '.Authorization')

echo $ACCESS

IDX=0
while [[ $IDX -lt 500 ]];  do
    RES=$(curl -s -o /dev/null -w "%{http_code}" -H "Authorization: ${ACCESS}" ${FAAS_PROFILE_URL})
    if [[ $RES -ne 200 ]]; then
      echo $IDX : $RES
    fi
    # curl -H "Authorization: ${ACCESS}" ${FAAS_PROFILE_URL}
    IDX=$((IDX+1)); 
done

